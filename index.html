<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>My Chess Bot</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
</head>
<body style="font-family: sans-serif; text-align: center; background-color: #f4f4f4; padding-top: 50px;">

    <h1>Stockfish Chess Bot</h1>
    
    <div id="myBoard" style="width: 400px; margin: auto;"></div>
    
    <p style="font-size: 20px;">Status: <span id="status">Your move!</span></p>

    <script>
        var board = null;
        var game = new Chess();
        var $status = $('#status');

        // 1. Start the Stockfish Brain
        var stockfish = new Worker('https://cdnjs.cloudflare.com/ajax/libs/stockfish.js/10.0.2/stockfish.js');

        // 2. What happens when you move a piece
        function onDrop (source, target) {
            var move = game.move({
                from: source,
                to: target,
                promotion: 'q' // always promote to queen for simplicity
            });

            // If it's an illegal move, snap back
            if (move === null) return 'snapback';

            $status.html('Stockfish is thinking...');

            // Ask Stockfish for a move
            stockfish.postMessage('position fen ' + game.fen());
            stockfish.postMessage('go depth 10'); 
        }

        // 3. What happens when Stockfish replies
        stockfish.onmessage = function(event) {
            if (event.data.includes('bestmove')) {
                var move = event.data.split(' ')[1];
                game.move({
                    from: move.substring(0, 2),
                    to: move.substring(2, 4),
                    promotion: 'q'
                });
                board.position(game.fen());
                $status.html('Your turn!');
            }
        };

        // 4. Initialize the board with "Piece Theme" fix
        var config = {
            draggable: true,
            position: 'start',
            onDrop: onDrop,
            // THIS LINE LOADS THE PIECE IMAGES FROM THE WEB
            pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
        };
        
        board = ChessBoard('myBoard', config);
    </script>
</body>
</html>
