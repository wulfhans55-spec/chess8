<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBER-BULLY STOCKFISH</title>
    
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Share+Tech+Mono&display=swap');
        
        body { 
            background: #000; color: #0f0; display: flex; flex-direction: column; align-items: center; 
            font-family: 'Share Tech Mono', monospace; margin: 0; height: 100vh; overflow: hidden; justify-content: center; 
        }

        .header { 
            font-family: 'Orbitron', sans-serif; font-size: 2.2rem; letter-spacing: 8px; color: #f00; 
            text-shadow: 0 0 10px #f00; margin-bottom: 5px; animation: glitch 1s infinite;
        }

        @keyframes glitch {
            0% { opacity: 1; transform: skew(0deg); }
            20% { opacity: 0.8; transform: skew(-1deg); }
            80% { opacity: 1; transform: skew(1deg); }
        }

        .info-panel { 
            background: rgba(10, 10, 10, 0.9); padding: 15px; margin-bottom: 10px; 
            text-align: center; width: 95vw; max-width: 1150px; border: 2px solid #0f0; 
            box-shadow: 0 0 15px #0f0;
        }
        
        #status { 
            font-family: 'Orbitron', sans-serif; font-weight: 900; color: #0f0; font-size: 1.4rem; 
            min-height: 2.8em; display: flex; align-items: center; justify-content: center; 
            text-transform: uppercase; text-shadow: 2px 2px 0px #000;
        }

       /* New wrapper to fit the ELO bar next to the board */
        .game-wrapper { display: flex; align-items: center; gap: 15px; }

        /* The actual ELO bar styling */
        .eval-bar-container {
            width: 25px; height: 420px; background: #000; border: 2px solid #0f0;
            position: relative; display: flex; flex-direction: column-reverse;
        }
        #eval-fill {
            width: 100%; height: 50%; background: #0f0; transition: height 0.5s ease;
            box-shadow: 0 0 10px #0f0;
        }

        #board { width: 420px; border: 4px solid #0f0; box-shadow: 0 0 25px #0f0; }
        .white-1e1d7 { background-color: #0a200a !important; box-shadow: inset 0 0 15px #0f0; } 
        .black-3c85d { background-color: #000000 !important; box-shadow: inset 0 0 15px #f00; }
        
        /* Piece Glow */
        .piece-417db { filter: drop-shadow(0 0 5px #0f0); }

        .graveyard { 
            width: 85px; height: 420px; background: #050505; border: 1px solid #0f0; 
            padding: 8px; display: flex; flex-wrap: wrap; align-content: flex-start; gap: 4px;
        }
        .graveyard img { width: 35px; height: 35px; filter: drop-shadow(0 0 2px #0f0); }
        .graveyard-label { width: 100%; font-size: 0.75rem; color: #f00; text-align: center; margin-bottom: 8px; font-weight: bold; }

        .controls { margin-top: 15px; }
       button { 
            background: #f00; color: #000; border: none; padding: 12px 35px; cursor: pointer; 
            font-family: 'Orbitron', sans-serif; font-weight: bold; text-transform: uppercase;
        }
        .hidden { display: none !important; }
        #loser-overlay.hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="loser-overlay" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9999; display:flex; justify-content:center; align-items:center; flex-direction:column;">
        <h1 style="font-family:'Orbitron',sans-serif; font-size:10rem; color:#f00; text-shadow: 0 0 20px #f00; margin:0; animation: glitch 0.2s infinite;">YOU SUCK</h1>
        <button onclick="location.reload()" style="margin-top:20px; padding:15px 40px; background:#f00; color:#000; font-family:'Orbitron'; font-weight:bold; cursor:pointer; border:none;">RETRY, LOSER</button>
    </div>

    <div class="info-panel">
        <div class="header"><b>[ CYBER-BULLY ]</b></div>
        <div id="status">PREPARE TO LOSE.</div>
    </div>

  <div class="game-wrapper">
        <div class="graveyard" id="player-kills"><div class="graveyard-label">AI LOSSES</div></div>
        
        <div class="eval-bar-container">
            <div id="eval-fill"></div>
        </div>

        <div id="board"></div>
        
        <div class="graveyard" id="ai-kills"><div class="graveyard-label">YOUR LOSSES</div></div>
    </div>

   <div class="controls">
        <button onclick="undoMove()">UNDO (COWARD)</button>
        <button onclick="toggleEval()">TOGGLE EVAL</button>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>

    <script>
        var board = null;
        var game = new Chess();
        var $status = $('#status');
        var moveTimer = null;
        var playerLostFirstPiece = false;
        var pieceBaseUrl = 'https://chessboardjs.com/img/chesspieces/wikipedia/';

        // Initialize Stockfish Brain
        var stockfish = new Worker('stockfish.js');

        const insults = {
            firstLoss: "I hope you weren't attached to that.",
            queenLoss: "Your Queen just left you. Womp Womp.",
            undo: ["Oh, a do-over? I didn't realize I was playing such a pussy.", "Move retracted. What a loser."],
            stalling: ["Are you thinking, or did your brain just crash?", "Hurry up. I have better things to calculate than your crappy moves.", "I’ve finished 14 million simulations while waiting for you.", "You're stalling because you're scared."],
            general: ["Processing... Analysis complete: That move was total garbage.", "My sensors indicate your current ELO is lower than your IQ.", "Move received. It was pathetic.", "I’ve simulated a billion games. In none of them do you suck this bad.", "I could beat you with 90% of my circuits fried.", "Your playstyle is a disgrace to the game.", "Is this your best, or are you purposely trying to waste my electricity?", "I’ve seen better positioning from a random number generator.", "Warning: Brain not detected. Are you sure you're a sentient life form?", "I’d call that a blunder, but that would imply you actually had a plan.", "Move accepted. It was shitty. I’m actually losing respect for humanity.", "I’m calculating 10 moves ahead. You’re struggling to find the 'Move' button.", "Don't worry about the clock. You'll be dead long before it runs out.", "Is your brain on 'Power Saver' mode? Because that was a dim move."]
        };

        function updateGraveyard() {
            $('#player-kills img, #ai-kills img').remove();
            game.history({verbose: true}).forEach(m => {
                if (m.captured) {
                    let container = (m.color === 'w') ? '#player-kills' : '#ai-kills';
                    let capColor = (m.color === 'w') ? 'b' : 'w';
                    $(container).append(`<img src="${pieceBaseUrl}${capColor}${m.captured.toUpperCase()}.png">`);
                }
            });
        }

       stockfish.onmessage = function(event) {
    // Logic to move the ELO bar
    if (event.data.includes('score cp')) {
        let score = parseInt(event.data.split('score cp ')[1]);
        if (game.turn() === 'b') score = -score; 
        let percent = 50 + (score / 15); 
        percent = Math.max(5, Math.min(95, percent)); 
        $('#eval-fill').css('height', percent + '%');
    }

    // Logic for AI move and Win/Loss display
    if (event.data.includes('bestmove')) {
        var moveStr = event.data.split(' ')[1];
        var moveObj = game.move({ from: moveStr.substring(0, 2), to: moveStr.substring(2, 4), promotion: 'q' });
        board.position(game.fen());
        updateGraveyard();

        // 3. WIN/LOSS DISPLAY
               if (game.in_checkmate()) {
                    $status.text("FATAL ERROR: YOUR KING HAS BEEN DELETED. LOSER.");
                    // Show the giant 'YOU SUCK' overlay
                    $('#loser-overlay').removeClass('hidden');
                    $('#loser-overlay').css('display', 'flex'); 
                    // CRASH THE SYSTEM TEXT
                    systemCrash();
                }
                } else if (game.in_draw() || game.in_stalemate()) {
        } else if (moveObj.captured) {
            $status.text(getBotInsult(moveObj));
        }
        resetStallTimer();
    }
};

        function getBotInsult(move) {
            if (move.captured === 'q') return insults.queenLoss;
            if (!playerLostFirstPiece && move.captured) { 
                playerLostFirstPiece = true; 
                return insults.firstLoss; 
            }
            return insults.general[Math.floor(Math.random() * insults.general.length)];
        }

        function onDrop(src, tgt) {
            let move = game.move({ from: src, to: tgt, promotion: 'q' });
            if (!move) return 'snapback';
            
            clearTimeout(moveTimer);
            updateGraveyard();
            
            if (game.in_checkmate()) {
                $status.text("SYSTEM CRITICAL. YOU WON? THIS MUST BE A BUG.");
                return;
            }

            var thinkingInsult = insults.general[Math.floor(Math.random() * insults.general.length)];
            $status.text(thinkingInsult);

            stockfish.postMessage('position fen ' + game.fen());
            stockfish.postMessage('go depth 12');
        }

        function resetStallTimer() {
            clearTimeout(moveTimer);
            moveTimer = setTimeout(() => {
                $status.text(insults.stalling[Math.floor(Math.random() * insults.stalling.length)]);
            }, 10000);
        }

        function undoMove() {
            game.undo(); game.undo();
            board.position(game.fen());
            updateGraveyard();
            $status.text(insults.undo[Math.floor(Math.random() * insults.undo.length)]);
            resetStallTimer();
        }

        board = Chessboard('board', {
            draggable: true, position: 'start', onDrop: onDrop,
            pieceTheme: pieceBaseUrl + '{piece}.png'
        });
        resetStallTimer();
       function toggleEval() {
            $('.eval-bar-container').toggleClass('hidden');
        }

        function systemCrash() {
            // Find every element that contains text and change it to ERROR
            $('*').contents().each(function() {
                if (this.nodeType === 3 && this.nodeValue.trim() !== "") {
                    this.nodeValue = " ERROR ";
                }
            });
            // Change the status bar specifically too
            $status.text("ERROR ERROR ERROR ERROR");
        }
    </script>
</body>
</html>
